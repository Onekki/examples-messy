{{#extend "css"}}
    <!-- CSS Libraries -->
{{/extend}}

<div class="main-wrapper">
    {{> navbar}}
    {{> aside}}
    <!-- Main Content -->
    <div class="main-content" style="min-height: 450px;">
        <section class="section">
            <div class="section-header">
                <div class="section-header-back">
                    <a href="#" onClick="javascript :history.go(-1)" class="btn btn-icon"><i
                            class="fas fa-arrow-left"></i></a>
                </div>
                <h1>{{ title }}</h1>
                <div class="section-header-breadcrumb">
<!--                    <div id="checkin-div" class="breadcrumb-item active">-->
<!--                        {{#with data}}-->
<!--                            <a href="#" onclick="onekey(this)" class="btn btn-icon icon-left btn-danger">一键全盘</a>-->
<!--                        {{/with}}-->
<!--                    </div>-->
                </div>
            </div>
            <div class="section-body">
                <div class="row">
                    <div class="col-12">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <tr>
                                    <th>#</th>
                                    <th>课程编号</th>
                                    <th>剩余时长</th>
                                    <th>课内习题正确率</th>
                                    <th>课后习题正确率</th>
                                    <th>操作</th>
                                </tr>

                              {{#equal data.studies.length 0}}
                                <tr>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td class="align-middle">该同学已经没有课程了</td>
                                  <td></td>
                                  <td></td>
                                </tr>
                              {{/equal}}
                                {{#each data.studies}}
                                    <tr>
                                        <td>{{ @index }}</td>
                                        <td>{{ courseCode }}</td>
                                        <td class="align-middle">{{ video }}</td>
                                        <td>
                                            <div class="badge badge-primary">{{#if in}}{{ in }}{{else}}
                                                无课内习题{{/if}}</div>
                                        </td>
                                        <td>
                                            <div class="badge badge-primary">{{ after }}</div>
                                        </td>
                                        <td>
                                            <button onclick="study(this, {{ courseCode }}, {{ video }})"
                                                    class="btn {{#if finished}}btn-success disabled{{else}}btn-warning{{/if}}">
                                                {{#if finished}}已盘{{else}}盘他{{/if}}</button>
                                        </td>
                                    </tr>
                                {{/each}}

                            </table>
                        </div>
                    </div>
                </div>

            </div>
            {{!-- section-body end --}}
        </section>
    </div>
    {{> footer}}
</div>

{{#extend "js"}}
    <script src="/js/plugin/jquery.nicescroll.min.js"></script>
    <script src="/js/plugin/sweetalert.min.js"></script>
    <script>
        function onekey(self) {
            $('.btn').addClass('disabled')
            $(self).addClass('disabled')
            $(self).addClass('btn-progress')
            $(self).blur()
            $.ajax( {
                type: "POST",
                url: "/api/njc/study/" + courseCode + '?video=' + video,
                headers: { Authorization: 'Bearer ' + getCookie('token') },
                dataType: "json",
                success: function ( data )
                {
                    window.location.reload()
                },
                error: function ( xhr, msg, error )
                {
                    $(self).removeClass('btn-progress')
                    swal( "出错了", xhr.responseText, 'error' )
                }
            } )
        }
        function study(self, courseCode, video)
        {
            $(self).addClass('disabled')
            $(self).addClass('btn-progress')
            $(self).blur()
            $.ajax( {
                type: "POST",
                url: "/api/njc/study/" + courseCode + '?video=' + video,
                headers: { Authorization: 'Bearer ' + getCookie('token') },
                dataType: "json",
                success: function ( data )
                {
                    window.location.reload()
                },
                error: function ( xhr, msg, error )
                {
                    $(self).removeClass('btn-progress')
                    swal( "出错了", xhr.responseText, 'error' )
                }
            } )
        }
    </script>
{{/extend}}
