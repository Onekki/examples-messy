{{#extend "css"}}
    <!-- CSS Libraries -->
{{/extend}}

<div class="main-wrapper">
    {{> navbar}}
    {{> aside}}
    <!-- Main Content -->
    <div class="main-content" style="min-height: 450px;">
        <section class="section">
            <div class="section-header">
                <div class="section-header-back">
                    <a href="#" onClick="javascript :history.go(-1)" class="btn btn-icon"><i class="fas fa-arrow-left"></i></a>
                </div>
                <h1>{{ title }}</h1>
            </div>
            <div class="section-body">
                <div class="form-group row mb-4">
                    <label class="col-form-label text-md-right col-12 col-md-3 col-lg-3">用户名</label>
                    <div class="col-sm-12 col-md-7">
                        <input id="username" type="text" class="form-control" name="username" tabindex="2" required>
                        <div class="invalid-feedback">
                            请输入用户名
                        </div>
                    </div>
                </div>
                <div class="form-group row mb-4">
                    <label class="col-form-label text-md-right col-12 col-md-3 col-lg-3">密码</label>
                    <div class="col-sm-12 col-md-7">
                        <input id="password" type="password" class="form-control" name="password" tabindex="2" required>
                        <div class="invalid-feedback">
                            请输入密码
                        </div>
                    </div>
                </div>
                <div class="form-group row mb-4">
                    <label class="col-form-label text-md-right col-12 col-md-3 col-lg-3"></label>
                    <div class="col-sm-12 col-md-7">
                        <button onclick="add(this)" class="btn btn-primary">绑定</button>
                    </div>
                </div>
            </div>
            {{!-- section-body end --}}
        </section>
    </div>
    {{> footer}}
</div>

{{#extend "js"}}
    <script src="/js/plugin/jquery.nicescroll.min.js"></script>
    <script src="/js/plugin/sweetalert.min.js"></script>
    <script>
        function add(self)
        {
            if ( !$( "#username" ).val() || !$( "#password" ).val() )
            {
                return;
            }
            $(self).addClass('disabled')
            $(self).addClass('btn-progress')
            $(self).blur()
            $.ajax( {
                type: "POST",
                url: "/api/njc/bind",
                headers: { Authorization: 'Bearer ' + getCookie('token') },
                dataType: "json",
                data: {
                    sysUserId: getCookie("sysUserId"),
                    username: $( "#username" ).val(),
                    password: $( "#password" ).val()
                },
                success: function ( data )
                {
                  $(self).removeClass('disabled')
                  $(self).removeClass('btn-progress')
                    swal( "绑定成功", 'success' )
                    window.location.href = '/njc'
                },
                error: function ( xhr, msg, error )
                {
                  $(self).removeClass('disabled')
                  $(self).removeClass('btn-progress')
                    $( "form" ).removeClass( 'was-validated' );
                    swal( "出错了", xhr.responseText, 'error' )
                }
            } )
        }

        function getCookie( cname )
        {
            var name = cname + "=";
            var ca = document.cookie.split( ';' );
            for ( var i = 0; i < ca.length; i++ )
            {
                var c = ca[i].trim();
                if ( c.indexOf( name ) == 0 ) return c.substring( name.length, c.length );
            }
            return "";
        }
    </script>
{{/extend}}
