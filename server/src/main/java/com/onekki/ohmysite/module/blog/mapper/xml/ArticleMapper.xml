<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.onekki.ohmysite.module.blog.mapper.ArticleMapper">
    <resultMap id="articleViewMap" type="com.onekki.ohmysite.module.blog.entity.ArticleView">
        <id property="id" column="a_id" />
        <result property="title" column="a_title" />
        <result property="summary" column="a_summary" />
        <result property="mdUrl" column="a_md_url" />
        <result property="html" column="a_html" />
        <result property="publishTime" column="a_publish_time" />
        <result property="editTime" column="a_edit_time" />
        <result property="state" column="a_state" />
        <association property="user" column="u_id" javaType="com.onekki.ohmysite.module.system.entity.User">
            <id property="id" column="u_id" />
            <result property="username" column="u_username" />
            <result property="nickname" column="u_nickname" />
            <result property="avatarUrl" column="u_avatar_url" />
        </association>
    </resultMap>
    <select id="pageView" resultMap="articleViewMap">
        SELECT
            tba.id as a_id,
            tba.title as a_title,
            tba.summary as a_summary,
            tba.md_url as a_md_url,
            tba.html as a_html,
            tba.publish_time as a_publish_time,
            tba.edit_time as a_edit_time,
            tba.state as a_state,
                tsu.id as u_id,
                tsu.username as u_username,
                tsu.nickname as u_nickname,
                tsu.avatar_url as u_avatar_url
        FROM t_blog_article tba
            LEFT JOIN t_system_user tsu on tba.uid = tsu.id
        <if test="skey != '' and skey != null ">
            WHERE tba.title LIKE CONCAT('%', #{skey}, '%')
            OR tba.summary LIKE CONCAT('%', #{skey}, '%')
            OR tsu.username LIKE CONCAT('%', #{skey}, '%')
            OR tsu.nickname LIKE CONCAT('%', #{skey}, '%')
        </if>
    </select>
</mapper>
